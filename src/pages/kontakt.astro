---
import BaseLayout from '../layouts/BaseLayout.astro';
---

<BaseLayout title="Kontakt | German Design System">
	<div class="max-w-4xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
		<header class="text-center mb-10">
			<h1 class="text-5xl font-extrabold text-manus-blue-500">Kontaktieren Sie uns</h1>
			<p class="mt-4 text-xl text-manus-gray-700">
				Wir freuen uns auf Ihre Nachricht. Füllen Sie das Formular aus und wir melden uns so schnell wie möglich bei Ihnen.
			</p>
		</header>

		<div class="bg-white p-8 rounded-lg shadow-xl">
			<form id="contactForm" class="space-y-6">
				<!-- Name -->
				<div>
					<label for="name" class="block text-sm font-medium text-manus-gray-700">Name</label>
					<input
						type="text"
						id="name"
						name="name"
						required
						class="mt-1 block w-full border-manus-gray-300 rounded-md shadow-sm focus:border-manus-blue-500 focus:ring-manus-blue-500 p-3 border"
					/>
				</div>

				<!-- Email -->
				<div>
					<label for="email" class="block text-sm font-medium text-manus-gray-700">E-Mail</label>
					<input
						type="email"
						id="email"
						name="email"
						required
						class="mt-1 block w-full border-manus-gray-300 rounded-md shadow-sm focus:border-manus-blue-500 focus:ring-manus-blue-500 p-3 border"
					/>
				</div>

				<!-- Firma (Optional) -->
				<div>
					<label for="company" class="block text-sm font-medium text-manus-gray-700">Firma (Optional)</label>
					<input
						type="text"
						id="company"
						name="company"
						class="mt-1 block w-full border-manus-gray-300 rounded-md shadow-sm focus:border-manus-blue-500 focus:ring-manus-blue-500 p-3 border"
					/>
				</div>

				<!-- Nachricht -->
				<div>
					<label for="message" class="block text-sm font-medium text-manus-gray-700">Nachricht</label>
					<textarea
						id="message"
						name="message"
						rows="4"
						required
						class="mt-1 block w-full border-manus-gray-300 rounded-md shadow-sm focus:border-manus-blue-500 focus:ring-manus-blue-500 p-3 border"
					></textarea>
				</div>

				<!-- Status Messages -->
				<div id="statusMessage" class="py-2 text-center font-medium hidden" role="alert"></div>

				<!-- Submit Button -->
				<div>
					<button
						type="submit"
						id="submitButton"
						class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-lg font-medium text-white bg-manus-success-500 hover:bg-manus-success-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-manus-success-500 transition duration-150 disabled:opacity-50 disabled:cursor-not-allowed"
					>
						Nachricht Senden
					</button>
				</div>
			</form>
		</div>
	</div>
</BaseLayout>

<script is:inline>
	document.addEventListener('DOMContentLoaded', () => {
		const form = document.getElementById('contactForm');
		const statusMessage = document.getElementById('statusMessage');
		const submitButton = document.getElementById('submitButton');

		if (!form || !statusMessage || !submitButton) return;

		const showMessage = (message, type) => {
			statusMessage.textContent = message;
			statusMessage.className = `py-2 text-center font-medium rounded-md ${type === 'success' ? 'bg-manus-success-100 text-manus-success-700' : 'bg-manus-alert-100 text-manus-alert-700'}`;
			statusMessage.style.display = 'block';
		};

		const toggleFormState = (isDisabled) => {
			submitButton.disabled = isDisabled;
			submitButton.textContent = isDisabled ? 'Sende...' : 'Nachricht Senden';
		};

		form.addEventListener('submit', async (e) => {
			e.preventDefault();
			statusMessage.style.display = 'none';
			toggleFormState(true);

			const formData = new FormData(form);
			const data = Object.fromEntries(formData.entries());

			try {
				const response = await fetch('/api/contact', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json',
					},
					body: JSON.stringify(data),
				});

				const result = await response.json();

				if (response.ok && result.success) {
					showMessage('Vielen Dank! Ihre Nachricht wurde erfolgreich gesendet.', 'success');
					form.reset();
				} else {
					// Fallback for non-200 but handled errors from the function
					showMessage(result.message || 'Ein Fehler ist aufgetreten. Bitte versuchen Sie es später erneut.', 'error');
				}
			} catch (error) {
				console.error('Fetch error:', error);
				showMessage('Netzwerkfehler. Bitte überprüfen Sie Ihre Verbindung.', 'error');
			} finally {
				toggleFormState(false);
			}
		});
	});
</script>
